<script server>

  let serverError = null
  let fieldErrors = {}

  if (request.method === 'POST') {
    const {
      identity,
      password,
    } = body()

    try {
      const user = signInWithPassword(identity, password)
      redirect(`/`)
    } catch (e) {
      // Try to extract field-level errors from PocketBase error response
      if (e && e.response && e.response.data) {
        fieldErrors = e.response.data
      }
      serverError = e.message
    }
  }
</script>

<h3 class="text-2xl font-bold mb-6">Password Login</h3>

<% if (serverError) { %>
<div class="alert alert-error mb-4"><%= serverError %></div>
<% } %>

<form method="post" class="card bg-base-100 shadow-md p-6 max-w-sm mx-auto space-y-4">

  <div class="form-control">
    <label class="label">
      <span class="label-text">Email</span>
    </label>
    <input name="identity" value="<%= data.identity %>" class="input input-bordered w-full validator" required />
    <% if (fieldErrors && fieldErrors.email) { %>
      <p class="validator-hint text-error mt-1"><%= fieldErrors.email.message %></p>
    <% } %>    
  </div>

  <div class="form-control">
    <label class="label">
      <span class="label-text">Password</span>
    </label>
    <input name="password" type="password" class="input input-bordered w-full validator" required />
    <% if (fieldErrors && fieldErrors.password) { %>
      <p class="validator-hint text-error mt-1"><%= fieldErrors.password.message %></p>
    <% } %>    
  </div>

  <button type="submit" class="btn btn-primary w-full">Login</button>

  <div class="text-center mt-2">
    <a href="/auth/forgot" class="link link-primary">Forgot Password?</a>
  </div>
</form>